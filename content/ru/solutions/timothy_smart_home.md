---
title: 'DIY умный дом программиста'
cover: timothy_smart_home/timothy_smart_home.webp
date: 2025-09-06
category: apartments_automation
---

:photo{
    src="timothy_smart_home/0.jpg"
    caption="Прихожая: датчик и две распределительные коробки"
    width="400"
    float="right"
}

Трёхкомнатная квартира в Москве. Все работы выполнены хозяином квартиры. Заниматься капитальным ремонтом ему не хотелось, поэтому кабельная система выполнена в пластиковых кабель-каналах, и частично использована существующая проводка.

| Оборудование | Функции |
| :---- | :---- |
| [Wiren Board 8](https://wirenboard.com/ru/catalog/kontrollery/) | Контроллер |
| [WBIO-DI-WD-14](https://wirenboard.com/ru/product/WBIO-DI-WD-14/) | Подключение дискретных сигналов |
| [WB-MDM3](https://wirenboard.com/ru/product/WB-MDM3/) | Диммирование светильников |
| [WB-MRM2-mini](https://wirenboard.com/ru/product/WB-MRM2-mini-v3/) | Управление недиммируемыми группами освещения |
| [WB-MSW v.4](https://wirenboard.com/ru/product/wb-msw-v4/) | Комбинированный датчик с сенсорами движения, температуры, влажности, CO₂ |

_«В моём случае Wiren Board — это не просто контроллер, а конструктор для взрослых. Можно прикрутить герконы за 100 рублей, можно завести бризер через Modbus, можно написать правила самому. Главное, что всё это реально работает в одной системе.
.», **Тимофей, хозяин квартиры**_

:gallery{
    :data='[
        ["timothy_smart_home/1.jpg", "А вот что там внутри"],
        ["timothy_smart_home/2.jpg", "Основной щит автоматизации"],
        ["timothy_smart_home/3.jpg", "Геркон на двери"],
        ["timothy_smart_home/4.jpg", "Универсальный датчик WB-MSW на кухне, справа сбоку термостат"]
    ]'
}

## Технические решения

### Структура системы

Оборудование автоматизации размещено в нескольких щитах. Один — основной, с контроллером Wiren Board 8\. Внутри — блок питания и модуль дискретных входов WBIO-DI-WD-14. Второй щиток — с диммерами WB-MDM3 и реле. В существующие монтажные коробки  установлены релейные модули WB-MRM2-mini вместо выключателей.

Сценарии автоматизации и интерфейс пользователя созданы при помощи ПО Sprut.Hub, работающем на контроллере.

### Софт

Хозяин исходил из того, что вся базовая логика не должна зависеть от доступности интернета или конкретного облака, и даже исправности контроллера. Поэтому для управления освещением использовал  релейные модули со входами и собственной логикой, реализованной в прошивке. Контроллер при этом может получать информацию от модуля и знать, что произошло, но управление остается «железным».

На контроллере работает «солянка» из систем автоматизаций: wb-rules, Sprut.Hub, и Home Assistant. «Умнодомные» функции между ними распределены так:

- на wb-rules написаны сценарии управления термоэлектрическими приводами;
- через Home Assistant организованы интеграции с пылесосом, домофон, и платформой HomeKit;
- все остальное возложено на  Sprut.Hub: работа с Zigbee-устройствами, сценарии, интерфейс пользователя.

Обмен данными между системами автоматизации происходит по MQTT.

:gallery{
    :data='[
        ["timothy_smart_home/5.jpg", "Шаровые краны с электроприводами «Пушок» перекрывают воду в случае протечки"],
        ["timothy_smart_home/6.jpg", "Универсальный датчик WB-MSW в санузле"],
        ["timothy_smart_home/7.jpg", "Дополнительный щит автоматизации"],
        ["timothy_smart_home/8.jpg", "Универсальный датчик WB-MSW в ванной"]
    ]'
}

### Управление освещением

В скриптах управления освещением предусмотрен приоритет действий пользователя: если человек вручную включил светильник, то сценарии его в течение часа не трогают. 

Еще из принципиального: при неисправности все важное должно работать. Это касается особенно санузлов. Реле, управляющие освещением, там установлены с нормально-замкнутыми контактами — если что-то выйдет из строя, то свет будет включен. Не идеально, но удобно. В спальне — наоборот, контакты нормально-разомкнутые, и свет будет выключен, чтобы не мешать спать.

Для управления освещением в основном использованы WB-MRM2-mini — компактные релейный модули, которые размещены в монтажных коробках. Те линии, которые надо диммировать, управляются WB-MDM3.

Выключатели используются как проводные (подключены к дискретным входам), так и Zigbee.

В работе сценариев освещения также используются герконы на межкомнатных дверях и сенсоры движения в WB-MSW v.4. Например, если открыть дверь в глухую комнату, а дальше движения зафиксировано не будет, свет погаснет через заданное время. В коридоре над дверными проемами установлены дополнительные датчики WB-MSW v.4, которые моментально реагируют при выходе человека из комнаты. Это особенно важно для детей — основной коридорный датчик видит их плохо.

:gallery{
    :data='[
        ["timothy_smart_home/9.jpg", "Универсальный датчик WB-MSW в коридоре перед ванной"],
        ["timothy_smart_home/10.jpg", "Соединители в кабельных каналах"],
        ["timothy_smart_home/11.jpg", "Внутри ПК1 используется WB-BUSHUB"],
        ["timothy_smart_home/12.jpg", "Привод штор в закрытом состоянии"]
    ]'
}


### Защита от протечек

Датчики протечки — Zigbee, расставлены под сантехникой.  Электроприводы «Пушок» установлены на кранах. Работают они на батарейках,  оборудованы Zigbee, .

### Климат

В каждом помещении установлен WB-MSW v.4 — комбинированный датчик от Wiren Board. Он определяет температуру, концентрацию CO₂ и влажность воздуха. 

Бризеры Tion 4s обеспечивают квартиру приточным воздухом. Каждый оснащен ESP32-стиком от LilyGo, взаимодействие с ними осуществляется  по MQTT. Стики прошиты прошивкой от dentra, интеграция их в Sprut.Hub работает «из коробки». Один из бризеров работает в режиме автоматического управления по CO₂ — стик читает значения уровня CO₂ из MQTT топика датчика WB-MSW, а автоматика бризера по этим данным регулирует обороты вентилятора.

Есть также термоэлектрические приводы на радиаторах — управляются  релейными модулями. Скрипт на wb-rules сравнивает температуру с уставкой и включает/выключает питание.

### Шторы

Управление шторами сделано на беспроводных Zigbee-моторах от Aqara. 

Для раздвижных штор используется Aqara E1,  Он просто ездит по карнизу и таскает за собой штору. Монтаж за полчаса, заряжать — раз в несколько месяцев. Управляется по сценарию: закрытие через полчаса после заката и открытие утром. 

На кухне используется рулонная штора с электроприводом, тоже от Aqara. И она нравится хозяину больше — моторчик, таскающий штору, выглядит несколько костыльно и не всегда работает хорошо. Иногда проскальзывает. Иногда продолжает работать, хотя уже достиг крайнего положения, и слышен скрип. Рулонная штора работает без сюрпризов.

## Дополнительные материалы

- [Умный дом от программиста: мой опыт и мои принципы](https://habr.com/ru/companies/wirenboard/articles/941496/)

Прочее

- [Примеры других внедрений](../solutions/)
- [Статьи о подборе оборудования и рассказы пользователей](../articles)
