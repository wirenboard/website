# Справка по работе с сайтом Wiren Board

## Полезные ссылки

- [Описание синтаксиса](/doc/syntax.md)
- [Структура страниц](/doc/page.md)
- [Каталог товаров](/doc/catalog.md)
- [Партнёры](/doc/partners.md)
- [Интеграторы](/doc/integrators.md)
- [Вакансии](/doc/jobs.md)
- [Статьи](/doc/articles.md)
- [Видео](/doc/video.md)
- [Готовые решения](/doc/solutions.md)
- [GitHub: управление файлами](https://docs.github.com/ru/repositories/working-with-files/managing-files)
- [GitHub: ветки и пуллреквесты](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests)

## Работа с Pull Request

Сам процесс создания новых веток, PR и прочего описан в документе [Процесс разработки проектов Wiren Board с использованием Git](https://github.com/wirenboard/codestyle/blob/master/workflow.md).

Здесь описаны консольные команды git, но их без труда можно по названиям переложить на интерфейс Github или VSCode.

### Для авторов изменений

Если вы впервые вносите правки, клонируйте репозиторий:
```bash
git clone https://github.com/wirenboard/website.git
```
В остальных случаях просто получите изменения с сервера и переключитесь обратно на main:
```bash
git fetch -ap
git checkout main
git pull
```

Далее:
1. Создайте и переключитесь на новую ветку:
   ```bash
   git checkout -b feature/имя-ветки
   ```
2. Внесите изменения и сохраните файлы.
3. Закоммитьте правки:
   ```bash
   git add .
   git commit -m "Краткое описание изменений"
   ```
   `git add .` добавляет все сделанные изменения, вместо него можно использовать `git add -p` — это позволит посмотреть все внесённые изменения и принять или отклонить часть из них.
4. Отправьте ветку в удалённый репозиторий:
   ```bash
   git push -u origin feature/имя-ветки
   ```
5. На GitHub перейдите в **Pull requests** → **New pull request**, заполните заголовок и описание, назначьте ревьювера marketing, создайте PR.

Если надо внести изменения в соданный PR:
1. Переключитесь на вашу ветку в пуллреквесте:
   ```bash
   git checkout feature/имя-ветки
   ```
2. Внесите изменения и сохраните файлы.
3. Закоммитьте правки:
   ```bash
   git add .
   git commit -m "Краткое описание изменений"
   ```
4. Отправьте изменения в ветке в удалённый репозиторий:
   ```bash
   git push
   ```

Если PR приняли:
7. Влейте изменения через **Squash and merge**.
8. Получите изменения с сервера, переключитесь на main и удалите ветку с которой вы работали:
   ```bash
   git fetch -ap
   git checkout main
   git branch -d feature/имя-ветки
   ```
Посмотреть список локальных веток `git branch`, локальных и удалённых — `git branch -a`.

### Для ревьюверов

Если вы впервые проверяете правки, клонируйте репозиторий:
```bash
git clone https://github.com/wirenboard/website.git
```
В остальных случаях просто получите изменения с сервера и переключитесь обратно на main:
```bash
git fetch -ap
git checkout main
git pull
```

Далее:
1. Перейдите в раздел **Pull requests** на GitHub, найдите нужный PR.
2. Загрузите и переключитесь на ветку PR:
   ```bash
   git fetch origin pull/<номер>/head:pr-<номер>
   git checkout pr-<номер>
   ```
3. Запустите локальный сервер (см. раздел Локальный запуск копии сайта) и проверьте изменения.
4. После проверки вернитесь на `main`:
   ```bash
   git checkout main
   git pull
   ```

## Способы редактирования и предпросмотра

### Офлайн-редактор (VSCode)

Для постоянной работы:
- Установите VSCode, плагин [vscode-mdx-wb-editor-tools](https://github.com/wirenboard/vscode-mdx-wb-editor-tools) и [Git](https://git-scm.com/).
- Клонируйте репозиторий и откройте папку в VS Code.

Всю работу с Git удобно выполнять прямо в VScode ([статья по теме](https://htmlacademy.ru/blog/git/git-in-vscode)).

### Онлайн-редактирование (GitHub Web)

Для быстрых правок:
- Откройте файл в репозитории на GitHub.
- Нажмите «Edit», внесите правки и выберите **Commit changes** в новую ветку.
- Несколько изменений по одной задаче делайте в одной ветке — это позволит ревьюверам посмотреть всё сразу не собирая одну ветку из нескольких.
- Создайте PR прямо из веб-интерфейса.

### Локальный запуск копии сайта

Тяжёлая артилерия, показывает изменения почти как они будут на сайте в итоге. Тут имеет смысл смотреть дизайн или общие сгерированные страницы с кучей карточек-ссылок, например, Статьи, Работа и т.п.

Для обычного внесения правок и предпросмотра рекомендуем использовать VSCode.

#### Как пользоваться
1. Убедитесь, что Node.js и pnpm установлены.
2. В корне проекта:
   ```bash
   pnpm install
   pnpm run dev
   ```
3. Откройте браузер по адресу `http://localhost:3000` для просмотра изменений. Не забудьте ввести в адресную строку url просматриваемой страницы, например `http://localhost:3000/ru/contents/articles`.

#### Особенности
Отображаться будет только контент, без остального содержимого сайта (навигации, футера и пр.).

![Пример страницы](doc/example.png)

Чтобы посмотреть, какой версии в github соответствует текущая версия сайта, можно использовать адрес `http://localhost:3000/version.txt`.
Это также будет работать, если сайт развёрнут целиком, как на https://wirenboard.com : `https://wirenboard.com/version.txt`.

По этому адресу будет доступен такой текстовый файл:

```
Base version: unknown
External version: main@d9faf525
```

В данном примере `main@d9faf525` — это версия сайта, которая соответствует текущему состоянию в репозитории. `main` - ветка, `d9faf525` - хэш коммита.
